<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Voting DApp</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/web3/1.7.3/web3.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background-color: #f0f0f0;
            min-height: 100vh;
            padding: 40px 20px;
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
        }

        .card {
            background: white;
            border-radius: 24px;
            padding: 60px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
            text-align: center;
        }

        .title {
            font-size: 60px;
            font-weight: 700;
            color: #333;
            margin-bottom: 60px;
            letter-spacing: -1px;
        }

        .section {
            margin-bottom: 50px;
        }

        .input-group {
            display: flex;
            gap: 20px;
            align-items: center;
            justify-content: center;
            flex-wrap: wrap;
            margin-bottom: 30px;
        }

        .input-field {
            padding: 16px 24px;
            font-size: 18px;
            border: 2px solid #ddd;
            border-radius: 12px;
            width: 300px;
            outline: none;
            transition: border-color 0.3s;
        }

        .input-field:focus {
            border-color: #4285f4;
        }

        .input-field::placeholder {
            color: #999;
        }

        .btn {
            padding: 16px 32px;
            font-size: 18px;
            font-weight: 600;
            border: none;
            border-radius: 12px;
            background: #4285f4;
            color: white;
            cursor: pointer;
            transition: all 0.3s;
            min-width: 140px;
        }

        .btn:hover {
            background: #3367d6;
            transform: translateY(-1px);
        }

        .btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }

        .status-panel {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 30px;
            text-align: left;
        }

        .status-panel h3 {
            margin-bottom: 10px;
            color: #333;
        }

        .status-item {
            margin: 5px 0;
            color: #666;
        }

        .message {
            padding: 16px;
            border-radius: 8px;
            margin: 20px 0;
            font-weight: 500;
        }

        .message.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .message.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .message.info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }

        .candidates-list {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 20px;
            margin-top: 30px;
            text-align: left;
        }

        .candidates-list h3 {
            margin-bottom: 20px;
            color: #333;
            text-align: center;
        }

        .candidate-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 8px;
            margin-bottom: 10px;
            background: white;
        }

        .candidate-info {
            font-weight: 500;
        }

        .candidate-votes {
            color: #4285f4;
            font-weight: bold;
        }

        .candidate-details {
            background: #e8f4fd;
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
            text-align: left;
        }

        .instructions {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 12px;
            padding: 20px;
            margin-top: 40px;
            text-align: left;
        }

        .instructions h3 {
            color: #856404;
            margin-bottom: 15px;
        }

        .instructions ol {
            color: #856404;
            padding-left: 20px;
        }

        .instructions li {
            margin: 8px 0;
        }

        @media (max-width: 768px) {
            .card {
                padding: 30px 20px;
            }
            
            .title {
                font-size: 40px;
                margin-bottom: 40px;
            }
            
            .input-group {
                flex-direction: column;
            }
            
            .input-field {
                width: 100%;
                max-width: 400px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="card">
            <h1 class="title">Voting DApp</h1>
            
            <!-- Status Panel -->
            <div class="status-panel">
                <h3>Connection Status</h3>
                <div class="status-item">Account: <span id="accountStatus">Not connected</span></div>
                <div class="status-item">Network: <span id="networkStatus">Not connected</span></div>
                <div class="status-item">Voting Status: <span id="votingStatus">Unknown</span></div>
                <div class="status-item">Contract: <span id="contractStatus">Not loaded</span></div>
            </div>

            <!-- Connect Button -->
            <div class="section">
                <button id="connectBtn" class="btn">Connect MetaMask</button>
            </div>

            <!-- Add Candidate Section -->
            <div class="section">
                <div class="input-group">
                    <input type="text" id="candidateName" class="input-field" placeholder="Candidate Name">
                    <button id="addCandidateBtn" class="btn">Add Candidate</button>
                    <button id="showCandidatesBtn" class="btn">Show Candidates</button>
                </div>
            </div>

            <!-- Voting Section -->
            <div class="section">
                <div class="input-group">
                    <input type="number" id="candidateId" class="input-field" placeholder="Candidate ID">
                    <button id="voteBtn" class="btn">Vote</button>
                    <button id="getCandidateDetailsBtn" class="btn">Get Candidate Details</button>
                </div>
            </div>

            <!-- Messages -->
            <div id="messageContainer"></div>

            <!-- Candidate Details -->
            <div id="candidateDetails" class="candidate-details" style="display: none;">
                <h3>Selected Candidate Details:</h3>
                <div id="candidateDetailsContent"></div>
            </div>

            <!-- Candidates List -->
            <div id="candidatesList" class="candidates-list" style="display: none;">
                <h3>All Candidates</h3>
                <div id="candidatesContent">No candidates found.</div>
            </div>

            <!-- Instructions -->
            <div class="instructions">
                <h3>Setup Instructions:</h3>
                <ol>
                    <li>Deploy the Voting smart contract in Remix IDE</li>
                    <li>Copy the deployed contract address and update the CONTRACT_ADDRESS variable in this code</li>
                    <li>Make sure MetaMask is installed and connected to the same network as your contract</li>
                    <li>Click "Connect MetaMask" to connect your wallet</li>
                    <li>Ensure you have ETH for gas fees to interact with the contract</li>
                </ol>
            </div>
        </div>
    </div>

    <script>
        // Contract configuration - UPDATE THIS WITH YOUR ACTUAL CONTRACT ADDRESS
        const CONTRACT_ADDRESS = "0xc7C13F5049b0A5231FFB9C83a4C3311befB6C4AA"; // ⚠️ REPLACE WITH YOUR DEPLOYED CONTRACT ADDRESS FROM REMIX
        
        // ⚠️ COPY THE ACTUAL ABI FROM REMIX IDE AFTER COMPILATION
        // Go to Remix -> Solidity Compiler -> Your Contract -> Copy ABI
        const CONTRACT_ABI = [
	{
		"anonymous": false,
		"inputs": [
			{
				"indexed": false,
				"internalType": "uint256",
				"name": "id",
				"type": "uint256"
			},
			{
				"indexed": false,
				"internalType": "string",
				"name": "name",
				"type": "string"
			}
		],
		"name": "CandidateAdded",
		"type": "event"
	},
	{
		"anonymous": false,
		"inputs": [
			{
				"indexed": false,
				"internalType": "address",
				"name": "voter",
				"type": "address"
			},
			{
				"indexed": false,
				"internalType": "uint256",
				"name": "candidateId",
				"type": "uint256"
			}
		],
		"name": "Voted",
		"type": "event"
	},
	{
		"inputs": [
			{
				"internalType": "string",
				"name": "_name",
				"type": "string"
			}
		],
		"name": "addCandidate",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"name": "candidates",
		"outputs": [
			{
				"internalType": "uint256",
				"name": "id",
				"type": "uint256"
			},
			{
				"internalType": "string",
				"name": "name",
				"type": "string"
			},
			{
				"internalType": "uint256",
				"name": "voteCount",
				"type": "uint256"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "candidatesCount",
		"outputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "getAllCandidates",
		"outputs": [
			{
				"components": [
					{
						"internalType": "uint256",
						"name": "id",
						"type": "uint256"
					},
					{
						"internalType": "string",
						"name": "name",
						"type": "string"
					},
					{
						"internalType": "uint256",
						"name": "voteCount",
						"type": "uint256"
					}
				],
				"internalType": "struct Voting.Candidate[]",
				"name": "",
				"type": "tuple[]"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "_candidateId",
				"type": "uint256"
			}
		],
		"name": "getCandidate",
		"outputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			},
			{
				"internalType": "string",
				"name": "",
				"type": "string"
			},
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "",
				"type": "address"
			}
		],
		"name": "hasVoted",
		"outputs": [
			{
				"internalType": "bool",
				"name": "",
				"type": "bool"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "_candidateId",
				"type": "uint256"
			}
		],
		"name": "vote",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	}
];

        // Global variables
        let web3;
        let contract;
        let userAccount;
        let hasVoted = false;

        // DOM elements
        const connectBtn = document.getElementById('connectBtn');
        const addCandidateBtn = document.getElementById('addCandidateBtn');
        const showCandidatesBtn = document.getElementById('showCandidatesBtn');
        const voteBtn = document.getElementById('voteBtn');
        const getCandidateDetailsBtn = document.getElementById('getCandidateDetailsBtn');
        const candidateNameInput = document.getElementById('candidateName');
        const candidateIdInput = document.getElementById('candidateId');
        const messageContainer = document.getElementById('messageContainer');
        const candidatesList = document.getElementById('candidatesList');
        const candidatesContent = document.getElementById('candidatesContent');
        const candidateDetails = document.getElementById('candidateDetails');
        const candidateDetailsContent = document.getElementById('candidateDetailsContent');

        // Event listeners
        connectBtn.addEventListener('click', connectWallet);
        addCandidateBtn.addEventListener('click', addCandidate);
        showCandidatesBtn.addEventListener('click', toggleCandidatesList);
        voteBtn.addEventListener('click', vote);
        getCandidateDetailsBtn.addEventListener('click', getCandidateDetails);

        // Connect wallet function
        async function connectWallet() {
            if (typeof window.ethereum !== 'undefined') {
                try {
                    showMessage('Connecting to MetaMask...', 'info');
                    
                    // Request account access
                    await window.ethereum.request({ method: 'eth_requestAccounts' });
                    
                    // Initialize Web3
                    web3 = new Web3(window.ethereum);
                    
                    // Get accounts
                    const accounts = await web3.eth.getAccounts();
                    userAccount = accounts[0];
                    
                    // Get network
                    const networkId = await web3.eth.net.getId();
                    
                    // Initialize contract
                    contract = new web3.eth.Contract(CONTRACT_ABI, CONTRACT_ADDRESS);
                    
                    // Update UI
                    updateConnectionStatus();
                    
                    // Load initial data
                    await checkVotingStatus();
                    
                    showMessage('Successfully connected to MetaMask!', 'success');
                    
                } catch (error) {
                    showMessage('Error connecting to MetaMask: ' + error.message, 'error');
                }
            } else {
                showMessage('MetaMask is not installed. Please install MetaMask to use this DApp.', 'error');
            }
        }

        // Update connection status
        function updateConnectionStatus() {
            document.getElementById('accountStatus').textContent = userAccount || 'Not connected';
            document.getElementById('networkStatus').textContent = web3 ? 'Connected' : 'Not connected';
            document.getElementById('contractStatus').textContent = contract ? 'Loaded' : 'Not loaded';
            
            // Enable/disable buttons
            const buttons = [addCandidateBtn, showCandidatesBtn, voteBtn, getCandidateDetailsBtn];
            buttons.forEach(btn => {
                btn.disabled = !contract;
            });
        }

        // Check voting status
        async function checkVotingStatus() {
            if (!contract || !userAccount) return;
            
            try {
                hasVoted = await contract.methods.hasVoted(userAccount).call();
                document.getElementById('votingStatus').textContent = hasVoted ? 'Already voted' : 'Can vote';
                voteBtn.disabled = hasVoted;
            } catch (error) {
                showMessage('Error checking voting status: ' + error.message, 'error');
            }
        }

        // Add candidate function
        async function addCandidate() {
            const candidateName = candidateNameInput.value.trim();
            
            if (!candidateName) {
                showMessage('Please enter a candidate name.', 'error');
                return;
            }
            
            if (!contract || !userAccount) {
                showMessage('Please connect your wallet first.', 'error');
                return;
            }
            
            try {
                showMessage('Adding candidate...', 'info');
                
                await contract.methods.addCandidate(candidateName).send({ from: userAccount });
                
                candidateNameInput.value = '';
                showMessage('Candidate added successfully!', 'success');
                
                // Refresh candidates list if visible
                if (candidatesList.style.display !== 'none') {
                    await loadCandidates();
                }
                
            } catch (error) {
                showMessage('Error adding candidate: ' + error.message, 'error');
            }
        }

        // Vote function
        async function vote() {
            const candidateId = candidateIdInput.value.trim();
            
            if (!candidateId) {
                showMessage('Please enter a candidate ID.', 'error');
                return;
            }
            
            if (!contract || !userAccount) {
                showMessage('Please connect your wallet first.', 'error');
                return;
            }
            
            if (hasVoted) {
                showMessage('You have already voted!', 'error');
                return;
            }
            
            try {
                showMessage('Casting vote...', 'info');
                
                await contract.methods.vote(parseInt(candidateId)).send({ from: userAccount });
                
                candidateIdInput.value = '';
                showMessage('Vote cast successfully!', 'success');
                
                // Update voting status
                await checkVotingStatus();
                
                // Refresh candidates list if visible
                if (candidatesList.style.display !== 'none') {
                    await loadCandidates();
                }
                
            } catch (error) {
                showMessage('Error casting vote: ' + error.message, 'error');
            }
        }

        // Get candidate details function
        async function getCandidateDetails() {
            const candidateId = candidateIdInput.value.trim();
            
            if (!candidateId) {
                showMessage('Please enter a candidate ID.', 'error');
                return;
            }
            
            if (!contract) {
                showMessage('Please connect your wallet first.', 'error');
                return;
            }
            
            try {
                const candidate = await contract.methods.getCandidate(parseInt(candidateId)).call();
                
                candidateDetailsContent.innerHTML = `
                    <p><strong>ID:</strong> ${candidate[0]}</p>
                    <p><strong>Name:</strong> ${candidate[1]}</p>
                    <p><strong>Vote Count:</strong> ${candidate[2]}</p>
                `;
                
                candidateDetails.style.display = 'block';
                showMessage('Candidate details loaded successfully!', 'success');
                
            } catch (error) {
                showMessage('Error getting candidate details: ' + error.message, 'error');
            }
        }

        // Toggle candidates list
        async function toggleCandidatesList() {
            if (candidatesList.style.display === 'none') {
                await loadCandidates();
                candidatesList.style.display = 'block';
                showCandidatesBtn.textContent = 'Hide Candidates';
            } else {
                candidatesList.style.display = 'none';
                showCandidatesBtn.textContent = 'Show Candidates';
            }
        }

        // Load candidates function
        async function loadCandidates() {
            if (!contract) {
                showMessage('Please connect your wallet first.', 'error');
                return;
            }
            
            try {
                const candidates = await contract.methods.getAllCandidates().call();
                
                if (candidates.length === 0) {
                    candidatesContent.innerHTML = '<p>No candidates found.</p>';
                } else {
                    candidatesContent.innerHTML = candidates.map(candidate => `
                        <div class="candidate-item">
                            <div class="candidate-info">
                                <strong>ID:</strong> ${candidate.id} | <strong>Name:</strong> ${candidate.name}
                            </div>
                            <div class="candidate-votes">Votes: ${candidate.voteCount}</div>
                        </div>
                    `).join('');
                }
                
            } catch (error) {
                showMessage('Error loading candidates: ' + error.message, 'error');
            }
        }

        // Show message function
        function showMessage(message, type = 'info') {
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${type}`;
            messageDiv.textContent = message;
            
            messageContainer.innerHTML = '';
            messageContainer.appendChild(messageDiv);
            
            // Auto-hide after 5 seconds
            setTimeout(() => {
                if (messageContainer.contains(messageDiv)) {
                    messageContainer.removeChild(messageDiv);
                }
            }, 5000);
        }

        // Initialize on page load
        window.addEventListener('load', () => {
            updateConnectionStatus();
            
            // Check if MetaMask is already connected
            if (typeof window.ethereum !== 'undefined') {
                window.ethereum.request({ method: 'eth_accounts' }).then(accounts => {
                    if (accounts.length > 0) {
                        connectWallet();
                    }
                });
            }
        });

        // Listen for account changes
        if (typeof window.ethereum !== 'undefined') {
            window.ethereum.on('accountsChanged', (accounts) => {
                if (accounts.length > 0) {
                    userAccount = accounts[0];
                    updateConnectionStatus();
                    checkVotingStatus();
                } else {
                    userAccount = null;
                    contract = null;
                    web3 = null;
                    updateConnectionStatus();
                }
            });
        }
    </script>
</body>
</html>